(window.webpackJsonp=window.webpackJsonp||[]).push([[33],{482:function(e,t,n){"use strict";n.r(t);var r=n(318),i=n(201),o=n(5),a=n(18),l=n(14),u=n(41),c=n.n(u),d=(n(281),n(2)),s=n(0),b=n(7);function f(e){return function(e){if(Array.isArray(e))return h(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return h(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return h(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function h(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function p(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function m(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?p(Object(n),!0).forEach((function(t){v(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):p(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function v(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var O=b.a.ACT_ID,j=b.a.BEHAVIOR,y=b.a.MODULE,S={components:{BtnFullScreen:i.a},data:function(){return{btnFullScreeShowed:!1}},computed:m(m(m(m(m(m(m({},Object(d.mapState)("vipInfo",["isVip"])),Object(d.mapState)(["docInfo","readerInfo"])),Object(d.mapState)("infrastructure",["eventBus"])),Object(d.mapState)("userInfo",["isIE"])),Object(d.mapState)("viewUI",["screenMode","pptStatus"])),Object(d.mapState)("readerInfo",["editModeGuideFlow","editableRtcs","tplName"])),{},{isPPT:function(){var e;return"ppt"===(null===(e=this.readerInfo)||void 0===e?void 0:e.tplName)}}),watch:{screenMode:function(e){var t=this;e||setTimeout((function(){t.adjustMenubar("exitFullscreen")}),100)}},mounted:function(){var e,t,n=this;this.$nextTick((function(){n.initEditorToolbar()})),null===(e=this.eventBus)||void 0===e||e.on("firstScreenRendered",(function(){n.updateMenubarWidth()})),this.editModeGuideFlow&&[1,3].includes(+(null===(t=this.editableRtcs)||void 0===t?void 0:t.edtStatus))&&Object(o.$)(".menubar").addClass("can-edit-doc")},beforeDestroy:function(){Object(o.$)(".menubar").empty(),Object(o.$)(".menubar").off("click"),Object(o.$)(".menubar").removeClass("can-edit-doc")},methods:m(m(m({},Object(d.mapMutations)("creader",["setEditorToolBarReady"])),Object(d.mapMutations)("viewUI",["setPptStatus"])),{},{initEditorToolbar:function(){var e,t,n,i,u,c=this,d=r.a;this.editModeGuideFlow&&(d=null===r.a||void 0===r.a||null===(u=r.a.filter)||void 0===u?void 0:u.call(r.a,(function(e){return"reset"!==(null==e?void 0:e.format)})));var b=this.isPPT?[{format:"thumbnail"}].concat(f(r.a)):d;this.editor=new r.b(this.$refs.editor,{debug:!1,placeholder:"",modules:{imageEdit:{},drag:{},history:{delay:1e3,userOnly:!1},catalog:!0,menubar:{el:".menubar",children:b},uploader:{},table:!0},theme:"wenku",scrollingContainer:void 0,strict:!1,bounds:void 0,readOnly:!0}),setTimeout((function(){c.setEditorToolBarReady(!0)}),200),this.handleBtnFullScreeVisible();null===(e=this.docInfo)||void 0===e||e.docId;var h=!1;this.editor.changeMenuBarState(!0,["fullscreen","more","thumbnail"]),this.editor.on((null===r.b||void 0===r.b||null===(t=r.b.events)||void 0===t?void 0:t.MENUBAR_LABEL_CLICK)||"menubar-label-click",(function(e){switch(e.format){case"fullscreen":c.$refs.btnfull.fullScreenHandle(),h=!0;break;case"more":h=!0;break;case"thumbnail":h=!0,c.setPptStatus(1===c.pptStatus?0:1),s.log.xsend(O,{behavior:j.CLICK,module:[y.MenuItem,"thumbnail"].join("_")})}})),this.editor.on(null===r.b||void 0===r.b||null===(n=r.b.events)||void 0===n?void 0:n.MENUBAR_LABEL_MOUSEENTER,(function(e){"more"===(null==e?void 0:e.format)&&c.handleBtnFullScreeVisible()}));var p=l.b.getFileType(null===(i=this.docInfo)||void 0===i?void 0:i.fileTypeKey);p="unknow"===p?"":p,Object(o.$)(".menubar").on("click",(function(){s.log.xsend(O,{behavior:j.CLICK,module:["Editor","menubar"].join("_"),index:c.tplName}),h?h=!1:c.isIE?Object(a.a)({content:"IE浏览器不支持在线编辑，推荐使用谷歌Chrome浏览器",delay:2e3}):c.editModeGuideFlow?c.eventBus.emit("editModeChange"):Object(a.a)({content:"".concat(p,"编辑功能升级中，敬请期待～"),delay:2e3})})),this.adjustMenubar()},updateMenubarWidth:function(){var e,t,n,r,i=Object(o.$)(".center-wrapper").width();null===(e=this.editor)||void 0===e||null===(t=e.getModule)||void 0===t||null===(n=t.call(e,"menubar"))||void 0===n||null===(r=n.updateWidth)||void 0===r||r.call(n,i),this.handleBtnFullScreeVisible()},adjustMenubar:function(e){var t=this;this.updateMenubarWidth(),"exitFullscreen"!==e&&window.addEventListener("resize",c()((function(){t.updateMenubarWidth()}),60))},handleBtnFullScreeVisible:function(){Object(o.$)(".menubar .ql-fullscreen").is(":visible")&&(this.btnFullScreeShowed||(this.btnFullScreeShowed=!0,s.log.xsend(O,{behavior:j.SHOW,module:[y.ReaderTopBar,"fullScreen"].join("_")})))}})},w=n(3),g=Object(w.default)(S,(function(){var e=this.$createElement,t=this._self._c||e;return t("div",[t("div",{ref:"editor",staticClass:"editor",attrs:{id:"editor-wrap"}}),this._v(" "),t("BtnFullScreen",{ref:"btnfull"})],1)}),[],!1,null,null,null);t.default=g.exports}}]);